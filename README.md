split_pfd.py: pdf をページごとに分割

extract_tables.py: 1 つの Word ファイルから表を検出し tmp に表の csv を出力

extract_tables_fromE.py: excel フォルダ内にあるファイルを csv に変換

extract_tables_fromW.py: word フォルダ内にあるファイルから表を抽出し、csv に変換

modify_csv.py: カラム名から不要なスペースを削除など

merge_tables.py: 各 csv のうち、フォーマットにあう表のみを結合。フォーマットに合わなかったものを出力

### 現在の作業

- pdf を word に変換
- `extract_tables_fromW.py`で各表を csv に出力
- `modify_csv.py`で多少フォーマットを整える(スペース削除、誤って分割されている特定の行をマージ)
- `merge_tables.py`でフォーマットに合う表のみを結合。出力先は`data/tables_from_docx/combined_tables.csv`。「作業名,名称,摘要,単位,所要量,備考」というカラムに対応するもののみ結合済み。作業名は extract 時に追加処理を行っている。

### extract_tables_fromW.py の説明

"""
DOCX ファイルからテーブルを抽出し、それぞれのテーブルを DataFrame として返します。
「(注)」を含む行を見つけたら現在の表を終了します。
「表」を含む行が見つかったら、以下のルールで新しい表の開始を判断します。 1. その「表」を含む行の次の次の行に「単位」という文字が含まれる場合：
その「次の次の行」を新しい表の開始（ヘッダー）と判断し、
「表」を含む行の次の行の文字列を「作業名」とします。 2. 上記以外の場合（「次の次の行」に「単位」が含まれない場合）：
「表」を含む行の次の行を新しい表の開始（ヘッダー）と判断し、
「作業名」は空とします。

    ファイル内の最初の表に対しては、表の1つ前の段落の文字列を「作業名」として追加します。
    「作業名」が存在しない場合は、その列を空として追加します。
    """

### メモ

- 結合時の出力を data/result.txt に残す。カラムの不一致、行内に改行がある、特定の行が空、などを結合を行わない条件にしているため、各条件に当てはまる表がどの程度あるかを把握できる。
- 結合に失敗しているものは、4 パターンある

1. 表自体は正しく取れているが、現在目標地点としている「作業名,名称,摘要,単位,所要量,備考」という項目に合致しない形の表(17-2.cssv など)
2. word ファイルの時点でテキストボックスが被る、行内改行などの影響で表が適切に取得できていない(16-1.csv など)
3. 表の冒頭がうまく取得できていないだけで、データの部分はおおよそ取得できている(205-1.csv など)
4. 表ではあるが歩掛のデータとして不要

表の取得をできていないものに関しては、pdf->excel 変換を行ったところ適切に表表記ができているようである。

- 多分 1,3 の対応をした上で 2 に関しては excel ファイルから同じような作業を行うのがよさそう
- 表の形が結構違うので割と手作業になってしまうのでは
- 別の表を参照する表はどうしよう
